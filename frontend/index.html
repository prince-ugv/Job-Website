<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Portal - Hot, Trending & Newest Jobs</title>
<link rel="stylesheet" href="style.css">
<style>
.jobs-list { min-height:100%; width:100%; box-shadow:none !important; }
.section-spinner { display:flex; align-items:center; justify-content:center; min-height:160px; width:100%; box-shadow:none; }
.spinner { border:6px solid #f3f3f3; border-top:6px solid #2f2b42; border-radius:50%; width:44px; height:44px; animation:spin 1s linear infinite; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
</style>
</head>
<body>

<!-- Sections -->
<section id="hot" style="display:none;"><h2>üî• Hot Jobs</h2><div id="hot-jobs" class="jobs-list"></div><div id="hot-pagination" class="pagination" style="display:flex;justify-content:center;gap:8px;margin-top:18px;"></div></section>
<section id="newest" style="display:none;"><h2>üÜï Newest Jobs</h2><div id="newest-jobs" class="jobs-list"></div><div id="newest-pagination" class="pagination" style="display:flex;justify-content:center;gap:8px;margin-top:18px;"></div></section>
<section id="barishal" style="display:none;"><h2>üåç Jobs in Barishal</h2><div id="barishal-jobs" class="jobs-list"></div><div id="barishal-pagination" class="pagination" style="display:flex;justify-content:center;gap:8px;margin-top:18px;"></div></section>

<script>
const API_BASE_URL = "https://job-website-mh1k.onrender.com";

const sectionToApi = { hot:'hot', newest:'newest', barishal:'barishal' };

function renderJobs(jobs, containerId) {
    const container = document.getElementById(containerId);
    if(!container) return;
    if(!jobs || jobs.length===0){ container.innerHTML='<div style="padding:16px;color:#888;">No jobs found.</div>'; return; }
    let favs = JSON.parse(localStorage.getItem('favouriteJobs')||'{}');
    container.innerHTML = jobs.map(job=>{
        const jobId = job.link || job.title;
        const isFav = !!favs[jobId];
        return `<div class="job-card job-card-minimal">
            ${job.image?`<img src="${job.image}" alt="${job.title}" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:12px;">`:''}
            <div style="display:flex;align-items:center;width:100%;margin-bottom:6px;">
                <span class="publish-date-text" style="color:#555;font-size:0.97em;">${job.publish_date?`Published: ${job.publish_date}`:''}</span>
                <button class="favourite-btn${isFav?' active':''}" data-jobid="${encodeURIComponent(jobId)}" title="Add to favourites">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="${isFav?'#ffb300':'none'}" stroke="#ffb300" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                  </svg>
                </button>
            </div>
            <a href="job-details.html?url=${encodeURIComponent(job.link)}" class="view-details-btn">View Details</a>
        </div>`;
    }).join('');

    container.querySelectorAll('.favourite-btn').forEach(btn=>{
        btn.addEventListener('click', function(e){
            e.preventDefault();
            const jobId = decodeURIComponent(this.getAttribute('data-jobid'));
            let favs = JSON.parse(localStorage.getItem('favouriteJobs')||'{}');
            if(favs[jobId]){ delete favs[jobId]; this.classList.remove('active'); this.querySelector('svg').setAttribute('fill','none'); }
            else{ favs[jobId]=true; this.classList.add('active'); this.querySelector('svg').setAttribute('fill','#ffb300'); }
            localStorage.setItem('favouriteJobs', JSON.stringify(favs));
        });
    });
}

async function fetchAndShowJobs(section,page=1){
    let apiSection = sectionToApi[section]||'';
    let url = `${API_BASE_URL}/scrape?${apiSection ? 'section='+apiSection+'&':''}page=${page}`;
    const containerId = section+'-jobs';
    const container = document.getElementById(containerId);
    if(container) container.innerHTML='<div class="section-spinner"><div class="spinner"></div></div>';
    try{
        const res = await fetch(url);
        const data = await res.json();
        renderJobs(data.jobs, containerId);
    }catch(e){
        if(container) container.innerHTML='<div style="padding:16px;color:#c00;">Failed to load jobs.</div>';
    }
}

// Fetch all sections
fetchAndShowJobs('hot',1);
fetchAndShowJobs('newest',1);
fetchAndShowJobs('barishal',1);
</script>
</body>
</html>
